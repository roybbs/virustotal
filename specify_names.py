#!/usr/bin/python

import json
import re
from pprint import pprint
import operator
import argparse
import sys

parser = argparse.ArgumentParser()
parser.add_argument('jsonfile', type=str, help='')
args = parser.parse_args()

jsonfile = args.jsonfile
f = open( jsonfile, 'r' )

data = json.load( f )

# pprint( data )

general_terms = {
"" : 1,
"Agent" : 1,
"Backdoor": 1,
"classic" : 1,
"ELF" : 1,
"EXPLOIT" : 1,
"DDoS" : 1,
"DoS" : 1,
"downloader" : 1,
"Fgt" : 1,
"Gen" : 1,
"generic" : 1,
"heur" : 1,
"ircbot" : 1,
"Linux" : 1,
"mips" : 1,
"Malware" : 1,
"None" : 1,
"Unix" : 1,
"Trojan" : 1,
"troj" : 1,
"variant" : 1,
"Win32" : 1,

"f04jh00e417" : 1,
"f04jh00d717" : 1,
"f04jc00a118" : 1,
"f04jc00a218" : 1,
"f04jc00a318" : 1,
"f04jc00a518" : 1,
"f04jc00a618" : 1,
"f04jc00a718" : 1,
"f04jc00a818" : 1,
"f04jc00a918" : 1,
"f04jc00aa18" : 1,
"f04jc00ab18" : 1,
"f04jc00ac18" : 1,
"f04jc00ad18" : 1,
"f04jc00ae18" : 1,
"f04jc00af18" : 1,
"f04jc00ag18" : 1,
"f04jc00ah18" : 1,
"f04jc00ai18" : 1,
"f04jc00aj18" : 1,
"f04jc00ak18" : 1,
"f04jc00al18" : 1,
"f04jc00am18" : 1,
"f04jc00an18" : 1,
"f04jc00ao18" : 1,
"f04jc00ap18" : 1,
"f04jc00ge17" : 1,
"f04jc00gi17" : 1,
"f04jc00h817" : 1,
"f04jc00i517" : 1,
"f04jc00id17" : 1,
"f04jc00ie17" : 1,
"f04jc00il17" : 1,
"f04jc00im17" : 1,
"f04jc00in17" : 1,
"f04jc00ir17" : 1,
"f04jc00is17" : 1,
"f04jc00it17" : 1,
"f04jc00j117" : 1,
"f04jc00j317" : 1,
"f04jc00j517" : 1,
"f04jc00j617" : 1,
"f04jc00jk17" : 1,
"f04jc00jm17" : 1,
"f04jc00jo17" : 1,
"f04jc00jp17" : 1,
"f04jc00jr17" : 1,
"f04jc00jt17" : 1,
"f04jc00jv17" : 1,
"f04jc00k217" : 1,
"f04jc00k517" : 1,
"f04jc00k617" : 1,
"f04jc00k817" : 1,
"f04jc00k917" : 1,
"f04jc00ka17" : 1,
"f04jc00kg17" : 1,
"f04jc00kl17" : 1,
"f04jc00km17" : 1,
"f04jc00kp17" : 1,
"f04jc00kq17" : 1,
"f04jc00kr17" : 1,
"f04jc00ks17" : 1,
"f04jc00kt17" : 1,
"f04jc00ku17" : 1,
"f04jc00l417" : 1,
"f04jc00l717" : 1,
"f04jc00la17" : 1,
"f04jc00lb17" : 1,
"f04jc00ld17" : 1,
"f04jc00le17" : 1,
"f04jc00lf17" : 1,
"f04jc00lg17" : 1,
"f04jc00lh17" : 1,
"f04jc00li17" : 1,
"f04jc00lj17" : 1,
"f04jc00lk17" : 1,
"f04jc00ll17" : 1,
"f04jc00lm17" : 1,
"f04jc00ln17" : 1,
"f04jc00lp17" : 1,
"f04jc00lq17" : 1,
"f04jc00lr17" : 1,
"f04jc00lt17" : 1,
"f04jc00lu17" : 1,
"f04jc00lv17" : 1,
"f0699de2" : 1,
"f06u4b" : 1,
"f0ocun" : 1,
"f17nl0" : 1,
"f25d0v" : 1,
"f47v0101" : 1,
"f47v0103" : 1,
"f47v0104" : 1,
"f47v0105" : 1,
"f47v0106" : 1,
"f47v0107" : 1,
"f47v0108" : 1,
"f47v0109" : 1,
"f47v0110" : 1,
"f47v0111" : 1,
"f47v0112" : 1,
"f47v0113" : 1,
"f47v0114" : 1,
"f47v0115" : 1,
"f47v0116" : 1,
"f47v0117" : 1,
"f47v0118" : 1,
"f47v0119" : 1,
"f47v0120" : 1,
"f47v0121" : 1,
"f47v0122" : 1,
"f47v0123" : 1,
"f47v0124" : 1,
"f47v0125" : 1,
"f47v0714" : 1,
"f47v0715" : 1,
"f47v0723" : 1,
"f47v0821" : 1,
"f47v0908" : 1,
"f47v0913" : 1,
"f47v0914" : 1,
"f47v0924" : 1,
"f47v0925" : 1,
"f47v0926" : 1,
"f47v0927" : 1,
"f47v0929" : 1,
"f47v1007" : 1,
"f47v1012" : 1,
"f47v1016" : 1,
"f47v1017" : 1,
"f47v1018" : 1,
"f47v1019" : 1,
"f47v1020" : 1,
"f47v1021" : 1,
"f47v1022" : 1,
"f47v1023" : 1,
"f47v1024" : 1,
"f47v1025" : 1,
"f47v1026" : 1,
"f47v1027" : 1,
"f47v1028" : 1,
"f47v1029" : 1,
"f47v1030" : 1,
"f47v1031" : 1,
"f47v1102" : 1,
"f47v1104" : 1,
"f47v1106" : 1,
"f47v1108" : 1,
"f47v1109" : 1,
"f47v1110" : 1,
"f47v1112" : 1,
"f47v1113" : 1,
"f47v1116" : 1,
"f47v1117" : 1,
"f47v1120" : 1,
"f47v1121" : 1,
"f47v1122" : 1,
"f47v1123" : 1,
"f47v1124" : 1,
"f47v1125" : 1,
"f47v1127" : 1,
"f47v1129" : 1,
"f47v1130" : 1,
"f47v1207" : 1,
"f47v1212" : 1,
"f47v1213" : 1,
"f47v1215" : 1,
"f47v1216" : 1,
"f47v1217" : 1,
"f47v1218" : 1,
"f47v1219" : 1,
"f47v1225" : 1,
"f47v1227" : 1,
"f47v1228" : 1,
"f47v1229" : 1,
"f47v1230" : 1,
"f47v1231" : 1,
"f4w1kz" : 1,
"f66k1d" : 1,
"f6sqku" : 1,
"f6te5s" : 1,
"f8x7r6" : 1,
"f04jc00a418" : 1,
"f04jc00aq18" : 1,
"f04jc00ia17" : 1,
"f04jc00ii17" : 1,
"f04jc00io17" : 1,
"f04jc00ip17" : 1,
"f04jc00iq17" : 1,
"f04jc00jg17" : 1,
"f04jc00jl17" : 1,
"f04jc00js17" : 1,
"f04jc00k717" : 1,
"f04jc00kd17" : 1,
"f04jc00kj17" : 1,
"f04jc00ko17" : 1,
"f04jc00lc17" : 1,
"f04jc00ls17" : 1,
"f47v0102" : 1,
"f47v0915" : 1,
"f47v1011" : 1,
"f47v1015" : 1,
"f47v1206" : 1,
"f47v1220" : 1,
"f47v1222" : 1,
"f47v1226" : 1,
"f5vx9z" : 1,
"r002c0cic17" : 1,
"r002c0cie17" : 1,
"r002c0da818" : 1,
"r002c0da918" : 1,
"r002c0daa18" : 1,
"r002c0dab18" : 1,
"r002c0dac18" : 1,
"r002c0dad18" : 1,
"r002c0dae18" : 1,
"r002c0daf18" : 1,
"r002c0dag18" : 1,
"r002c0dah18" : 1,
"r002c0dai18" : 1,
"r002c0daj18" : 1,
"r002c0dak18" : 1,
"r002c0dal18" : 1,
"r002c0dam18" : 1,
"r002c0dan18" : 1,
"r002c0dao18" : 1,
"r002c0daq18" : 1,
"r002c0dat18" : 1,
"r002c0did17" : 1,
"r002c0die17" : 1,
"r002c0dil17" : 1,
"r002c0dl117" : 1,
"r002c0dlf17" : 1,
"r002c0dlh17" : 1,
"r002c0dli17" : 1,
"r002c0dln17" : 1,
"r002c0oa618" : 1,
"r002c0oie17" : 1,
"r002c0oif17" : 1,
"r002c0oln17" : 1,
"r002c0pa418" : 1,
"r002c0pa618" : 1,
"r002c0pa718" : 1,
"r002c0pa918" : 1,
"r002c0paa18" : 1,
"r002c0pab18" : 1,
"r002c0pac18" : 1,
"r002c0pad18" : 1,
"r002c0pae18" : 1,
"r002c0paf18" : 1,
"r002c0pag18" : 1,
"r002c0pah18" : 1,
"r002c0pai18" : 1,
"r002c0paj18" : 1,
"r002c0pam18" : 1,
"r002c0pas18" : 1,
"r002c0plh17" : 1,
"r002c0pli17" : 1,
"r002c0plr17" : 1,
"r002c0plu17" : 1,
"r002c0plv17" : 1,
"r002c0raa18" : 1,
"r002c0rac18" : 1,
"r002c0rag18" : 1,
"r002c0ran18" : 1,
"r002c0rie17" : 1,
"r002c0rif17" : 1,
"r002c0taf18" : 1,
"r002c0tai18" : 1,
"r002c0tak18" : 1,
"r002c0tao18" : 1,
"r002c0tap18" : 1,
"r002h01a918" : 1,
"r002h01ad18" : 1,
"r002h01ae18" : 1,
"r002h01ag18" : 1,
"r002h01ai18" : 1,
"r002h01aj18" : 1,
"r002h01ao18" : 1,
"r002h01ap18" : 1,
"r002h01aq18" : 1,
"r002h01ar18" : 1,
"r002h01as18" : 1,
"r002h01at18" : 1,
"r002h01au18" : 1,
"r002h06ap18" : 1,
"r002h06kd17" : 1,
"r002h07ah18" : 1,
"r002h07ai18" : 1,
"r002h0ca918" : 1,
"r002h0cab18" : 1,
"r002h0cac18" : 1,
"r002h0cad18" : 1,
"r002h0cag18" : 1,
"r002h0cai18" : 1,
"r002h0caj18" : 1,
"r002h0cak18" : 1,
"r002h0can18" : 1,
"r002h0cap18" : 1,
"r002h0clc17" : 1,
"r002h0clh17" : 1,
"r002h0da918" : 1,
"r002h0dab18" : 1,
"r004c0dai18" : 1,
"r004c0dli17" : 1,
"r004c0plu17" : 1,
"r004h01ae18" : 1,
"r00ec0dak18" : 1,
"r00ec0pai18" : 1,
"r00wc0dh317" : 1,
"r00wc0dhi17" : 1,
"r00wc0dhm17" : 1,
"r00wc0oh417" : 1,
"r00wc0ohi17" : 1,
"r00wc0phh17" : 1,
"r00wc0phi17" : 1,
"r00wc0phj17" : 1,
"r00wc0pho17" : 1,
"r00wc0php17" : 1,
"r00wc0rhm17" : 1,
"r00xc0dh317" : 1,
"r011c0da818" : 1,
"r011c0dac18" : 1,
"r011c0dad18" : 1,
"r011c0dae18" : 1,
"r011c0daf18" : 1,
"r011c0dag18" : 1,
"r011c0dah18" : 1,
"r011c0dai18" : 1,
"r011c0daj18" : 1,
"r011c0dak18" : 1,
"r011c0dlg17" : 1,
"r011c0dlh17" : 1,
"r011c0dli17" : 1,
"r011c0dlj17" : 1,
"r011c0dlk17" : 1,
"r011c0dll17" : 1,
"r011c0dlm17" : 1,
"r011c0dln17" : 1,
"r011c0dlo17" : 1,
"r011c0dlp17" : 1,
"r011c0dls17" : 1,
"r011c0pa818" : 1,
"r011c0paa18" : 1,
"r011c0pab18" : 1,
"r011c0pac18" : 1,
"r011c0pad18" : 1,
"r011c0pae18" : 1,
"r011c0paf18" : 1,
"r011c0pag18" : 1,
"r011c0pah18" : 1,
"r011c0pai18" : 1,
"r011c0paj18" : 1,
"r011c0pal18" : 1,
"r011c0pap18" : 1,
"r011c0pl217" : 1,
"r011c0plh17" : 1,
"r011c0pli17" : 1,
"r011c0plj17" : 1,
"r011c0plk17" : 1,
"r011c0plo17" : 1,
"r011c0plu17" : 1,
"r011c0plv17" : 1,
"r011c0wa318" : 1,
"r011h01ae18" : 1,
"r011h01ag18" : 1,
"r011h01ah18" : 1,
"r011h01aj18" : 1,
"r011h01ak18" : 1,
"r011h01aq18" : 1,
"r011h01lk17" : 1,
"r011h06ai18" : 1,
"r017c0da918" : 1,
"r017c0daa18" : 1,
"r017c0dac18" : 1,
"r017c0dad18" : 1,
"r017c0dae18" : 1,
"r017c0pab18" : 1,
"r017c0pac18" : 1,
"r017c0pad18" : 1,
"r017c0pae18" : 1,
"r01bc0dh317" : 1,
"r01bc0dh717" : 1,
"r01bc0ohb17" : 1,
"r023c0di317" : 1,
"r02kc0ohb17" : 1,
"r02lc0dh217" : 1,
"r02lc0dh417" : 1,
"r031c0dh317" : 1,
"r032c0paj18" : 1,
"r032c0pkb17" : 1,
"r032c0pl317" : 1,
"r032c0pl417" : 1,
"r032c0pl817" : 1,
"r035c0pl817" : 1,
"r03bc0dac18" : 1,
"r03bc0dad18" : 1,
"r03bc0daf18" : 1,
"r03bc0dah18" : 1,
"r03bc0dai18" : 1,
"r03bc0pae18" : 1,
"r03bc0paf18" : 1,
"r03bc0pag18" : 1,
"r03bc0pai18" : 1,
"r03bc0paj18" : 1,
"r03kc0rh317" : 1,
"r047c0chn17" : 1,
"r047c0dh117" : 1,
"r047c0dh217" : 1,
"r047c0dh317" : 1,
"r047c0dh617" : 1,
"r047c0dhf17" : 1,
"r047c0dhg17" : 1,
"r047c0dhl17" : 1,
"r047c0dho17" : 1,
"r047c0dhr17" : 1,
"r047c0dhs17" : 1,
"r047c0dhv17" : 1,
"r047c0di417" : 1,
"r047c0di917" : 1,
"r047c0dia17" : 1,
"r047c0oh317" : 1,
"r047c0oi417" : 1,
"r047c0oi517" : 1,
"r047c0phs17" : 1,
"r047c0pi217" : 1,
"r047c0rhi17" : 1,
"r047c0rhq17" : 1,
"r047c0ri217" : 1,
"r047c0ri817" : 1,
"r04bc0ris17" : 1,
"r056c0dac18" : 1,
"r056c0dae18" : 1,
"r056c0daj18" : 1,
"r056c0dak18" : 1,
"r056c0pab18" : 1,
"r056c0pac18" : 1,
"r056c0pl217" : 1,
"r0f0c0ch317" : 1,
"r0f0c0dh317" : 1,
"r0f0c0dh417" : 1,
"r0f0c0oh317" : 1,
"r0f0c0pi717" : 1,
"r0fcc0dhm17" : 1,
"r0fcc0ph317" : 1,
"r1sljs" : 1,
"r2afwq" : 1,
"r3rep9" : 1,
"r5gbv8" : 1,
"r6ls3x" : 1,
"r9cn1f" : 1,
"r9iwy3" : 1,
}

replacebox = {
  "gafgyt" : "bashlite",
  "lizkebab" : "bashlite",
  "lightaidra" : "bashlite",
  "qbot" : "bashlite",
  "torlus" : "bashlite",
  "lizardstresser" : "bashlite",
  "miraiddos" : "mirai",
}

for k in general_terms.keys():
  del general_terms[ k ]
  general_terms[ k.lower() ] = 1

def checkPhrase( phrase ):
    if re.match("[a-zA-Z]", phrase) is None:
      return False

    if len(phrase) <= 3:
      return False

    if general_terms.has_key( s ):
      return False


    return True

def normalizePhrase( phrase ):
  if replacebox.has_key( phrase ):
    return replacebox[ phrase ]
  return phrase
  

if not data.has_key('scans'):
  sys.stdout.write("%s\n"%(jsonfile))
  exit(0)

securitytools = data['scans']
vote_box = {}
for k in securitytools.keys():
  info = securitytools[k]
  res = str(info['result'])
  elems = re.split(r"[!_\.:/\-()\[\] ]+", res)
  for s in elems:
    s = s.lower()
    if checkPhrase( s ):
      s = normalizePhrase( s )
      if not vote_box.has_key( s ):
        vote_box[ s ] = 1

      vote_box[ s ] += 1
  

sorted_vote = sorted(vote_box.items(), key=operator.itemgetter(1),reverse=True)
sys.stdout.write("%s"%(jsonfile))
count = 0
for k, v in sorted_vote:
  sys.stdout.write(",%s,%d"%(k,v))
  if count >= 3:
    break

print ""

f.close()

